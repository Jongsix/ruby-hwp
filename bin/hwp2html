#!/usr/bin/ruby1.9.1
# coding: utf-8

require 'optparse'
require 'hwp'
require 'hwp/parser'
require 'builder'

opts = {}
op = OptionParser.new do |op|
	#op.banner = "Usage: hwp2html [OPTION] [FILE]"
	op.banner = "Usage: hwp2html [OPTION] [FILE]"
	op.separator ' '
	#op.separator "Output control:"
	#op.on('-o', '--output=FILE', 'output file') { opts[:action] = :output }
	#op.separator ''
	op.on_tail('-h', '--help', 'Show this message') { puts op; exit }
end

files = op.parse ARGV

if files.empty?
	puts 'Must specify 1 .hwp file.'
	puts op
	exit 1
end

hwp = HWP.open(ARGV[0])

builder = Builder::XmlMarkup.new(:target=>STDOUT, :indent=>2)
builder.html do
	builder.head do
		builder.meta('http-equiv'=>'Content-Type', 'content'=>'application/html; charset=utf-8')
		builder.meta('name'=>'HWP File Format', 'version'=> hwp.header.version)
	end

	builder.body do
		hwp.bodytext.para_headers.each do |para_header|
			# FIXME m_pos 적용해야 한다.
			size = hwp.doc_info.char_shapes[para_header.para_char_shape.m_id[0]].size / 100
			builder.p do
				builder.div('style'=> "font-size: #{size}px") do
					builder.text! para_header.para_text.to_s
				end
			end
		end
		hwp.close
	end
end
